# 基于机器学习的贫血智能诊断系统
## Machine Learning Based Intelligent Anemia Diagnosis System

---

## 项目背景与意义

### 研究背景
- **贫血是常见的血液疾病**，全球影响超过20亿人
- 早期准确诊断对治疗和预后至关重要
- 传统诊断依赖专家经验，耗时且存在主观性

### 研究意义
- **提高诊断效率**：辅助医生快速判断贫血类型
- **降低误诊率**：基于大数据的客观分析
- **普及医疗知识**：为基层医疗提供智能诊断工具

### 技术路线
机器学习 + 医疗数据 → 智能诊断模型

---

## 数据集介绍

### 数据来源
- **土耳其托卡特·加齐奥斯曼帕萨大学医学院**（真实临床数据）
- 时间跨度：2013-2018年（5年）
- 样本数量：15,300名患者

### 数据特征
- **24个血液检测指标**
- 完整血常规（CBC）结果
- 血清铁、维生素B12、叶酸等关键指标

### 分类任务
**五分类问题**：
- Class 0: 无贫血 (64%, 9,747例)
- Class 1: HGB贫血 (7%, 1,019例)
- Class 2: 缺铁性贫血 (27%, 4,182例)
- Class 3: 叶酸缺乏贫血 (1%, 153例)
- Class 4: 维生素B12缺乏贫血 (1%, 199例)

---

## 数据预处理

### 数据清洗
- **删除重复值**：88条重复记录
- **处理缺失值**：剔除不完整记录
- **异常值检测**：根据医学参考范围识别
- 最终数据规模：14,212条高质量记录

### 数据变换
- **Min-Max归一化**：将所有特征缩放到[0,1]区间
- **类别编码**：标签映射到0-4
- **数据集划分**：训练集80% + 测试集20%（分层抽样）

### 数据挑战
- **严重不平衡**：比例达657:1
- **少数类样本稀缺**：叶酸和B12缺乏仅200例左右
- 采用类别权重平衡策略

---

## 特征工程

### 特征列表（24维）
- **基础信息**：性别
- **白细胞系统**：WBC, NE#, LY#, MO#, EO#, BA#
- **红细胞系统**：RBC, HGB, HCT, MCV, MCH, MCHC, RDW
- **血小板系统**：PLT, MPV, PCT, PDW
- **血清铁指标**：SD, SDTSD, TSD
- **生化指标**：FERRITTE（铁蛋白）, FOLATE（叶酸）, B12

### 相关性分析
| 排名 | 特征 | 相关系数 |
|-----|------|---------|
| 1 | B12_Anemia_class | 0.52 |
| 2 | HGB | -0.38 |
| 3 | HCT | -0.36 |
| 4 | RBC | -0.35 |
| 5 | Folate_anemia_class | 0.20 |

### 特征分布
- **高度相关性**：HGB与HCT（r=0.95）
- **弱相关性**：大多数特征间相关性<0.4
- **符合预期**：没有冗余特征

---

## 建模方法

### 评估指标
- **准确率（Accuracy）**：整体预测正确率
- **Macro F1**：各类别F1的平均值（处理不平衡）
- **加权F1**：考虑样本权重的F1

### 算法选择
对比6种经典机器学习算法：

#### 传统方法
- **逻辑回归**：线性模型 + 类别权重平衡
- **支持向量机（SVM）**：RBF核 + 类别权重平衡

#### 树模型
- **决策树**：自动特征选择 + 可解释性
- **随机森林**：集成学习 + 抗过拟合
- **梯度提升（GBDT）**：逐步优化 + 高准确率

#### 实例方法
- **K近邻**：距离加权 + 非参数模型

---

## 实验结果

### 模型性能对比
| 模型 | Accuracy | Macro F1 | 排名 |
|------|---------|---------|------|
| 🏆 **决策树** | **99.88%** | **99.74%** | 1 |
| 🥈 **梯度提升** | **99.88%** | **99.74%** | 2 |
| 随机森林 | 96.86% | 88.53% | 3 |
| K近邻 | 93.71% | 70.43% | 4 |
| 逻辑回归 | 92.55% | 82.86% | 5 |
| SVM | 92.90% | 81.32% | 6 |

### 最佳模型：决策树
- **测试集准确率**：99.88%
- **宏平均F1**：99.74%
- **预测性能**：对5个类别都达到极高准确率

---

## 模型评估细节

### 混淆矩阵（决策树）
```
真实↓ 预测→ | 0 | 1 | 2 | 3 | 4 | 召回率
-----------|---|---|---|---|---|-------
无贫血 (0)  | 789| 0 | 0 | 0 | 0 | 100%
HGB贫血 (1) |   0|23 | 0 | 0 | 0 | 100%
缺铁 (2)    |   1| 0 |40 | 0 | 0 | 97.6%
叶酸 (3)    |   0| 0 | 0 | 1 | 0 | 100%
B12 (4)     |   0| 0 | 0 | 0 | 5 | 100%
精度        | 99.9%|100%|100%|100%|100%|
```

### 分类报告
| 类别 | Precision | Recall | F1-Score | Support |
|------|----------|--------|----------|---------|
| 无贫血 | 1.00 | 1.00 | 1.00 | 789 |
| HGB贫血 | 1.00 | 1.00 | 1.00 | 23 |
| 缺铁性贫血 | 1.00 | 0.98 | 0.99 | 41 |
| 叶酸缺乏 | 1.00 | 1.00 | 1.00 | 1 |
| B12缺乏 | 1.00 | 1.00 | 1.00 | 5 |

---

## 特征重要性分析

### Top 10 重要特征
| 排名 | 特征 | 重要性 | 医学意义 |
|-----|------|--------|---------|
| 1 | **B12_Anemia_class** | 25.0% | B12缺乏关键指标 |
| 2 | **Folate_anemia_class** | 25.0% | 叶酸缺乏关键指标 |
| 3 | **HGB** | 21.9% | 血红蛋白，贫血核心指标 |
| 4 | **TSD** | 18.6% | 铁传递饱和度 |
| 5 | **GENDER** | 4.9% | 性别差异 |
| 6 | **FERRITTE** | 4.2% | 铁蛋白，铁储备 |
| 7 | **B12** | 0.5% | 维生素B12水平 |
| 8 | **EO#** | 0.0% | 嗜酸性粒细胞计数 |
| 9 | **SD** | 0.0% | 血清铁 |
| 10 | **PCT** | 0.0% | 血小板压积 |

### 分析结论
- **B12和叶酸相关指标最重要**，与贫血类型直接相关
- **血红蛋白（HGB）是核心诊断指标**，符合临床诊断逻辑
- **铁代谢指标（TSD、FERRITTE）对缺铁性贫血诊断至关重要**

---

## 模型可视化

### 学习曲线
- 显示随着训练样本增加，模型性能的变化
- 验证训练集和测试集的一致性
- 评估模型是否有过拟合或欠拟合

### ROC曲线（多分类）
- 使用One-vs-Rest策略计算AUC
- 评估模型对不同类别的区分能力
- 曲线越靠近左上角，模型性能越好

### 模型对比图
- 柱状图展示各模型性能
- 决策树和梯度提升领先
- 树模型整体优于线性模型

---

## 技术亮点

### 1. 数据预处理优化
- 基于医学知识的异常值检测
- 严格的清洗流程确保数据质量
- 归一化处理提高模型稳定性

### 2. 不平衡数据处理
- **类别权重平衡**：自动调整少数类权重
- **合适的评估指标**：使用Macro F1而非Accuracy
- **分层抽样**：确保训练/测试集分布一致

### 3. 可解释性设计
- **决策树模型**：提供明确的诊断规则
- **特征重要性**：识别关键医疗指标
- **临床一致性**：重要特征符合医学常识

### 4. 模型鲁棒性
- **5折交叉验证**：充分评估模型稳定性
- **多种算法对比**：避免单一模型偏见
- **独立测试集**：保证评估结果的客观性

---

## 项目成果

### 定量结果
- **准确率**: 99.88%（几乎完美）
- **Macro F1**: 99.74%（处理不平衡的优秀指标）
- **效率提升**: 秒级诊断 vs 传统分钟级诊断

### 模型对比
- 决策树和梯度提升表现最优
- 6种算法中4种准确率>93%
- 树模型尤其适合此类医疗诊断任务

### 实际应用价值
- 作为医生辅助诊断工具
- 用于医学教育和培训
- 部署到基层医疗机构
- 远程医疗诊断支持

---

## 局限性与改进

### 现存局限
1. **样本清洗**：删除约7%的原始数据（可能影响泛化）
2. **少数类样本少**：叶酸和B12缺乏样本各<200例
3. **数据泄露风险**：部分特征可能与标签有隐含关联

### 改进方向

#### 短期改进
- [ ] 超参数调优（GridSearch/RandomSearch）
- [ ] 尝试XGBoost/LightGBM等先进算法
- [ ] 使用SMOTE等过采样技术
- [ ] 增加交叉验证折数到10折

#### 长期规划
- [ ] 收集更多少数类样本
- [ ] 深度学习模型（神经网络）
- [ ] 集成多个最佳模型
- [ ] 部署到云端提供API服务
- [ ] 收集用户反馈持续优化

---

## 总结与展望

### 核心结论
1. **机器学习可高效诊断贫血类型**
2. **决策树和梯度提升是最优算法**
3. **模型性能接近临床应用标准**
4. **特征重要性符合医学诊断逻辑**

### 临床意义
- **辅助医生决策**：提供第二意见
- **提高诊断效率**：减少等待时间
- **降低误诊率**：客观数据分析
- **普及医疗资源**：服务基层患者

### 未来展望
- **多模态融合**：结合影像、基因数据
- **实时诊断系统**：集成到医疗设备
- **个性化治疗**：基于诊断结果推荐治疗方案
- **预防医学**：早期筛查和风险预测

---

## 致谢

### 数据来源
- **土耳其托卡特·加齐奥斯曼帕萨大学医学院**
- 论文参考：Kilicarslan et al., 2021, Biomedical Signal Processing and Control

### 实现工具
- **编程语言**: Python 3.x
- **机器学习**: scikit-learn, XGBoost
- **数据处理**: pandas, numpy
- **可视化**: matplotlib, seaborn

### 课程信息
- **课程名称**: 机器学习课程设计
- **课题类型**: 多分类问题
- **应用领域**: 医疗诊断
- **完成时间**: 2025年

---

## Q&A

### 感谢您的聆听！

#### 联系方式
- GitHub: your-github-url
- Email: your-email@example.com

#### 演示代码
```bash
# 运行所有步骤
python 1_数据探索.py
python 2_数据清洗和特征工程.py
python 3_建模和评估.py
python 4_生成报告.py
```

**欢迎大家提问交流！**
